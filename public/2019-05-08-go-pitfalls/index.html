<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Pitfalls I encountered while learning Go - cuffaro.com</title><meta name="Description" content="cuffaro.com"><meta property="og:url" content="http://localhost:1313/2019-05-08-go-pitfalls/">
  <meta property="og:site_name" content="cuffaro.com">
  <meta property="og:title" content="Pitfalls I encountered while learning Go">
  <meta property="og:description" content="I started learning Go on and off out of curiosity, late last year.
Being mainly a Python developer, I figured learning a different programming language would help to broaden my horizons.
Recently though, we adopted the language for some work projects, therefore I took the plunge and got to really hacking around with it.
The following are some noobie gotchas that I bumped into during development of my latest project (link below). Mostly these came around while trying to figure out how to use mocks and asserts in unit tests with the testify collection of packages.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-05-08T20:56:19+02:00">
    <meta property="article:modified_time" content="2019-05-08T20:56:19+02:00">
    <meta property="article:tag" content="Go">
    <meta property="article:tag" content="Junior">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="Pitfalls I encountered while learning Go">
  <meta name="twitter:description" content="I started learning Go on and off out of curiosity, late last year.
Being mainly a Python developer, I figured learning a different programming language would help to broaden my horizons.
Recently though, we adopted the language for some work projects, therefore I took the plunge and got to really hacking around with it.
The following are some noobie gotchas that I bumped into during development of my latest project (link below). Mostly these came around while trying to figure out how to use mocks and asserts in unit tests with the testify collection of packages.">
      <meta name="twitter:site" content="@maiku1008">
<meta name="application-name" content="cuffaro.com">
<meta name="apple-mobile-web-app-title" content="cuffaro.com"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/2019-05-08-go-pitfalls/" /><link rel="prev" href="http://localhost:1313/2019-02-11-things-i-learned-first-year-dev/" /><link rel="next" href="http://localhost:1313/2019-09-22-zsh-jump-workon/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pitfalls I encountered while learning Go",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/2019-05-08-go-pitfalls\/"
        },"genre": "posts","keywords": "go, junior","wordcount":  934 ,
        "url": "http:\/\/localhost:1313\/2019-05-08-go-pitfalls\/","datePublished": "2019-05-08T20:56:19+02:00","dateModified": "2019-05-08T20:56:19+02:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "xxxx"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="cuffaro.com">cuffaro.com</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="cuffaro.com">cuffaro.com</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Pitfalls I encountered while learning Go</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2019-05-08">2019-05-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;934 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="content" id="content"><p>I started learning Go on and off out of curiosity, late last year.</p>
<p>Being mainly a Python developer, I figured learning a different programming language would help to broaden my horizons.</p>
<p>Recently though, we adopted the language for some work projects, therefore I took the plunge and got to really hacking around with it.</p>
<p>The following are some noobie gotchas that I bumped into during development of my latest project (link below).
Mostly these came around while trying to figure out how to use mocks and asserts in unit tests with the <a href="https://github.com/stretchr/testify" target="_blank" rel="noopener noreffer ">testify</a> collection of packages.</p>
<h2 id="validate-if-an-interface-is-satisfied-by-a-struct">Validate if an interface is satisfied by a struct</h2>
<p>Here is the first snippet:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/stretchr/testify/mock&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ClientInterface defines a common interface to
</span></span></span><span class="line"><span class="cl"><span class="c1">// *http.Client and our *MockClient
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ClientInterface</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Do</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Validate satisfaction of interface
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">_</span> <span class="nx">ClientInterface</span> <span class="p">=</span> <span class="p">(</span><span class="o">*</span><span class="nx">MockClient</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">_</span> <span class="nx">ClientInterface</span> <span class="p">=</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// MockClient embeds mock.Mock to reuse its methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">MockClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mock</span><span class="p">.</span><span class="nx">Mock</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Do is a mock of http.Client&#39;s method Do
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">mockClient</span> <span class="o">*</span><span class="nx">MockClient</span><span class="p">)</span> <span class="nf">Do</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span> <span class="o">:=</span> <span class="nx">mockClient</span><span class="p">.</span><span class="nf">Called</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">args</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="mi">0</span><span class="p">).(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">),</span> <span class="nx">args</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Zooming into the interesting part:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Validate satisfaction of interface
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">_</span> <span class="nx">ClientInterface</span> <span class="p">=</span> <span class="p">(</span><span class="o">*</span><span class="nx">MockClient</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">_</span> <span class="nx">ClientInterface</span> <span class="p">=</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We assign a <code>MockClient</code> nil pointer to an empty var of type <code>ClientInterface</code>.
In the second line we do the same, but with an <code>http.Client</code>.</p>
<p>This is a fun little trick we use in order to validate whether or not both structs satisfy our <code>ClientInterface</code>.</p>
<p>If they don&rsquo;t, the program will complain at build time.</p>
<p>We will be using our custom interface in the next step.</p>
<h2 id="use-interfaces-instead-of-structs-to-pass-data-around">Use interfaces instead of structs to pass data around</h2>
<p>A key function of my app is the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GetResponse gets a response
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GetResponse</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">c</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I wanted to write tests for this, which would verify its functionality.</p>
<p>I also did not wish to test this against a live environment, since unit tests should be isolated,
so I had to create my own mock version of <code>*http.Client</code>, and use it as an argument to my GetResponse function.</p>
<p>It turns out that Go is pretty anal about its types (no real surprise there!).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./requests_test.go:47:28: cannot use mockClient <span class="o">(</span><span class="nb">type</span> *MockClient<span class="o">)</span> as <span class="nb">type</span> *http.Client in argument to GetResponse
</span></span></code></pre></td></tr></table>
</div>
</div><p>So I resolved instead to pass it my interface, <code>ClientInterface</code>, which implements <code>Do()</code>, as described above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GetResponse gets a response
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GetResponse</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">c</span> <span class="nx">ClientInterface</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dereferencing-nil-pointers-is-bad">Dereferencing nil pointers is bad</h2>
<p>At this point, I just wanted to see the test work, so in a hurry I loaded a couple nil pointers into the arguments I needed, as such:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">    <span class="c1">// Initialize mock object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">mockClient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">MockClient</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Set return value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">returnValue</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">req</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Set expectations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">mockClient</span><span class="p">.</span><span class="nf">On</span><span class="p">(</span><span class="s">&#34;Do&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">).</span><span class="nf">Return</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">GetResponse</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">mockClient</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This returned a nasty error:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">panic</span><span class="p">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">memory</span> <span class="n">address</span> <span class="ow">or</span> <span class="n">nil</span> <span class="n">pointer</span> <span class="n">dereference</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="k">signal</span> <span class="n">SIGSEGV</span><span class="p">:</span> <span class="n">segmentation</span> <span class="n">violation</span> <span class="n">code</span><span class="o">=</span><span class="mh">0xffffffff</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x0</span> <span class="n">pc</span><span class="o">=</span><span class="mh">0x3a6626</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dereferencing means reading the memory value at a given address.
So when we have a pointer to something, to dereference the pointer means to read or write the data that the pointer points to.</p>
<p>If that pointer points to nothing we will get the above error.</p>
<p>Time to fix that by creating a request object with some dummy content.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Initialize mock object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">mockClient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">MockClient</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Set return value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">body</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">NopCloser</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="s">&#34;hello world&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nx">returnValue</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span> <span class="s">&#34;200 OK&#34;</span><span class="p">,</span> <span class="nx">Body</span><span class="p">:</span> <span class="nx">body</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">req</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Set expectations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">mockClient</span><span class="p">.</span><span class="nf">On</span><span class="p">(</span><span class="s">&#34;Do&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">).</span><span class="nf">Return</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">GetResponse</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">mockClient</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="parametrize-tests-with-a-struct">Parametrize tests with a struct</h2>
<p>Finally, I parametrized different calls by using a struct, like described in the <a href="https://github.com/golang/go/wiki/TableDrivenTests" target="_blank" rel="noopener noreffer ">official docs</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// A struct for testing the different calls
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">responseTests</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">method</span>       <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">endpoint</span>     <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">auth</span>         <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">requestBody</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">responseBody</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}{</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">TokenEndPoint</span><span class="p">,</span> <span class="nx">authString</span><span class="p">,</span> <span class="nx">OauthTokenBody</span><span class="p">,</span> <span class="nx">tokenEndpointResponse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">ContactEndpoint</span><span class="p">,</span> <span class="nx">bearerToken</span><span class="p">,</span> <span class="nx">CreateContactBody</span><span class="p">,</span> <span class="nx">contactEndpointResponse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">checkEndpoint</span><span class="p">,</span> <span class="nx">bearerToken</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">checkEndpointResponse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">DomainEndpoint</span><span class="p">,</span> <span class="nx">bearerToken</span><span class="p">,</span> <span class="nx">buyDomainBody</span><span class="p">,</span> <span class="nx">buyDomainEndpointResponse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestGetResponse</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">assert</span> <span class="o">:=</span> <span class="nx">assert</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Initialize mock object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">mockClient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">MockClient</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">rt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">responseTests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Setup request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">req</span> <span class="o">:=</span> <span class="nf">SetRequest</span><span class="p">(</span><span class="nx">rt</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> <span class="nx">rt</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">rt</span><span class="p">.</span><span class="nx">auth</span><span class="p">,</span> <span class="nx">rt</span><span class="p">.</span><span class="nx">requestBody</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Setup expected response
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">body</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">NopCloser</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">rt</span><span class="p">.</span><span class="nx">responseBody</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nx">returnValue</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span> <span class="s">&#34;200 OK&#34;</span><span class="p">,</span> <span class="nx">Body</span><span class="p">:</span> <span class="nx">body</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Set expectations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">mockClient</span><span class="p">.</span><span class="nf">On</span><span class="p">(</span><span class="s">&#34;Do&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">).</span><span class="nf">Once</span><span class="p">().</span><span class="nf">Return</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Run the thing!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">GetResponse</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">mockClient</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Assert expectations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">mockClient</span><span class="p">.</span><span class="nf">AssertExpectations</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Looping these this way seems like a much cleaner way to do things, for readbility, and also for being able to add more calls easily if needed.</p>
<h2 id="to-conclude">To Conclude</h2>
<p>The above can all be found in my <a href="https://github.com/micuffaro/checkdomain" target="_blank" rel="noopener noreffer ">checkdomain</a> project.</p>
<p>Go is awesome, and I&rsquo;m looking forward to mess around with it more.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2019-05-08</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2019-05-08-go-pitfalls/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/2019-05-08-go-pitfalls/" data-title="Pitfalls I encountered while learning Go" data-via="maiku1008" data-hashtags="go,junior"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/2019-05-08-go-pitfalls/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/2019-05-08-go-pitfalls/" data-title="Pitfalls I encountered while learning Go"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/go/">Go</a>,&nbsp;<a href="/tags/junior/">Junior</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2019-02-11-things-i-learned-first-year-dev/" class="prev" rel="prev" title="Things I learned during my first year as a Junior Developer"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Things I learned during my first year as a Junior Developer</a>
            <a href="/2019-09-22-zsh-jump-workon/" class="next" rel="next" title="Easy workflow for switching Python virtual environments">Easy workflow for switching Python virtual environments<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2018 - 2025</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
